function facebookGallery(a){new SFP(a)}var SFP=function(){function a(a){this.config=a,this.setDefaults(),this.init()}return a.prototype.setDefaults=function(){this.setGalleryDefaults(),this.setPostsDefaults()},a.prototype.setPostsDefaults=function(){if(this.config.postsOptions){if(void 0==this.config.postsOptions.wookmarkOptions){var a={autoResize:!0,offset:50,itemWidth:250,flexibleWidth:400,outerOffset:50};this.config.postsOptions.wookmarkOptions=a}void 0==this.config.postsOptions.postsCountLimit&&(this.config.postsOptions.postsCountLimit=100)}},a.prototype.setGalleryDefaults=function(){if(this.config.galleryOptions){if(void 0==this.config.galleryOptions.wookmarkOptions){var a={autoResize:!0,offset:10,itemWidth:200,flexibleWidth:400,outerOffset:10};this.config.galleryOptions.wookmarkOptions=a}void 0==this.config.galleryOptions.imagesCountLimit&&(this.config.galleryOptions.imagesCountLimit=100),this.config.galleryOptions.includeAlbums&&this.convertStringArrayToLowerCase(this.config.galleryOptions.includeAlbums),this.config.galleryOptions.excludeAlbums&&this.convertStringArrayToLowerCase(this.config.galleryOptions.excludeAlbums)}},a.prototype.convertStringArrayToLowerCase=function(a){for(var b=0;b<a.length;b++)a[b]=a[b].toLocaleLowerCase()},a.prototype.init=function(){this.initFbScript(document,"facebook-jssdk"),this.initFb(window)},a.prototype.initFb=function(a){var b=this;a.fbAsyncInit=function(){FB.init({appId:b.config.appId,xfbml:!0,version:"v2.8"}),b.config.postsOptions&&b.loadPosts(b.config.postsOptions.elementId),b.config.galleryOptions&&b.loadAlbums(b.config.galleryOptions.elementId)}},a.prototype.initFbScript=function(a,b){if(!a.getElementById(b)){var c=a.getElementsByTagName("script")[0],d=a.createElement("script");d.id=b,d.src="http://connect.facebook.net/en_US/sdk.js",c.parentNode.insertBefore(d,c)}},a.prototype.loadPosts=function(a){var b=this,c=new PostsLoader(this.config),d=c.loadPosts(),e=document.getElementById(a),f=document.createElement("ul");f.className="sfp-posts",e.appendChild(f),d.then(function(a){a.forEach(function(a){var c=b.createPostElement(a);f.appendChild(c)})})},a.prototype.createPostElement=function(a){var b=this,c=document.createElement("img");c.src=this.getPostImageUrl(a),c.onload=function(){return b.initWookmark(".sfp-posts",b.config.postsOptions.wookmarkOptions)};var d=document.createElement("div");d.innerText=new Date(a.created_time).toLocaleDateString(),d.className="sfp-post-date";var e=document.createElement("div");e.className="sfp-post-text",e.innerText=a.message;var f=document.createElement("div");if(f.appendChild(d),f.appendChild(c),f.appendChild(e),a.attachments&&a.attachments.data&&a.attachments.data.length>0&&("share"==a.attachments.data[0].type||"video_share_youtube"==a.attachments.data[0].type)){var g=document.createElement("a");g.href=a.attachments.data[0].url,g.className="sfp-post-link",g.innerText=a.attachments.data[0].title,f.appendChild(g)}var h=document.createElement("li");return h.className="sfp-post",h.appendChild(f),h},a.prototype.getPostImageUrl=function(a){return null!=a.full_picture?a.full_picture:this.config.postsOptions.defaultPostImageUrl},a.prototype.loadAlbums=function(a){var b=this,c=new AlbumsLoader(this.config),d=c.loadAlbums(),e=document.getElementById(a),f=document.createElement("ul");f.className="sfp-albums",e.appendChild(f),d.then(function(a){a.forEach(function(a){var c=b.createAlbumElement(a);f.appendChild(c)})})},a.prototype.initWookmark=function(a,b){new Wookmark(a,b)},a.prototype.createAlbumElement=function(a){var b=this,c=document.createElement("img");c.src=a.picture,c.onload=function(){return b.initWookmark(".sfp-albums",b.config.galleryOptions.wookmarkOptions)};var d=document.createElement("div");d.className="sfp-album-count-wrapper";var e=document.createElement("div");e.className="sfp-album-count-box";var f=document.createElement("div");f.className="sfp-album-count",f.innerText=a.count>this.config.galleryOptions.imagesCountLimit?this.config.galleryOptions.imagesCountLimit.toString():a.count.toString(),e.appendChild(f),d.appendChild(e);var g=document.createElement("div");g.className="sfp-album-title",g.innerText=a.name;var h=document.createElement("div");h.appendChild(c),h.appendChild(d),h.appendChild(g);var i=document.createElement("div");i.id=this.getImagesId(a);var j=document.createElement("li");return j.className="sfp-album",j.appendChild(h),j.appendChild(i),h.onclick=function(c){0==b.getAlbumImagesElement(a).childNodes.length?b.loadAlbumImages(a):b.showAlbum(a)},j},a.prototype.getAlbumImagesElement=function(a){var b=this.getImagesId(a);return document.getElementById(b)},a.prototype.getImagesId=function(a){return"images-"+a.id},a.prototype.getImageId=function(a){return"image-"+a.id},a.prototype.loadAlbumImages=function(a){var b=this,c=this.getAlbumImagesElement(a);a.images.then(function(d){d.forEach(function(b){var d=document.createElement("a");d.href=b.picture,d.setAttribute("data-lightbox",a.id),c.appendChild(d)}),b.showAlbum(a)})},a.prototype.showAlbum=function(a){var b=this.getAlbumImagesElement(a);if(b.children.length>0){b.children[0].click()}},a}(),PostsLoader=function(){function a(a){this.config=a}return a.prototype.loadPosts=function(){var a=this;return new Promise(function(b,c){FB.api("/"+a.config.fbPage+"?fields=posts.limit("+a.config.postsOptions.postsCountLimit+"){full_picture,created_time,message,id,attachments{type,url,title}}",{access_token:a.config.accessToken},function(a){for(var c=a.posts.data,d=[],e=0;e<c.length;e++)c[e].message&&d.push(c[e]);b(d)})})},a}(),AlbumsLoader=function(){function a(a){this.config=a}return a.prototype.loadAlbums=function(){var a=this;return new Promise(function(b,c){FB.api("/"+a.config.fbPage+"/albums?limit=100&fields=created_time,name,id,count,picture{url},link,photos{images}",{access_token:a.config.accessToken},function(c){var d=c.data,e=[];if(void 0==a.config.galleryOptions.excludeAlbums&&void 0==a.config.galleryOptions.includeAlbums)for(var f=0;f<d.length;f++)d[f].count>0&&(d[f].picture=c.data[f].picture.data.url,d[f].images=a.loadAlbumImages(d[f]),e.push(d[f]));else if(a.config.galleryOptions.includeAlbums)for(var f=0;f<d.length;f++)d[f].count>0&&a.arrayContains(a.config.galleryOptions.includeAlbums,d[f].name)&&(d[f].picture=c.data[f].picture.data.url,d[f].images=a.loadAlbumImages(d[f]),e.push(d[f]));else for(var f=0;f<d.length;f++)d[f].count>0&&!a.arrayContains(a.config.galleryOptions.excludeAlbums,d[f].name)&&(d[f].picture=c.data[f].picture.data.url,d[f].images=a.loadAlbumImages(d[f]),e.push(d[f]));b(e)})})},a.prototype.arrayContains=function(a,b){return a.indexOf(b.toLowerCase())>=0},a.prototype.loadAlbumImages=function(a){var b=this;return new Promise(function(c,d){FB.api("/"+a.id+"?fields=photos.limit(100){images}",{access_token:b.config.accessToken},function(d){var e=a.count>0?b.getImagesForAlbum(d.photos.data):[];c(e)})})},a.prototype.getImagesForAlbum=function(a){for(var b=[],c=0;c<a.length;c++){var d={id:a[c].id,picture:a[c].images[0].source};b.push(d)}return b},a}();